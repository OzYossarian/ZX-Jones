\section{Simplifying Qutrit ZX-Diagrams}

We now turn to the qutrit ZX-calculus and examine the analogous story to that of the previous subsection
but now for the case where the dimension of the vector space carried by the wires is $d=3$.


\subsection{The Qutrit ZX-Calculus}


As in the qubit case, the qutrit ZX calculus is about spiders connected by wires, but there are key differences, some subtler than others.
Again, spiders come in two species, Z (green) and X (red),
with the three-dimensional Z basis denoted as $\{\ket{0},\ket{1},\ket{2}\}$ .
% To get a feel for the qutrit calculus, we outline these differences briefly here before giving a formal definition. First of all, the qubit $Z$-basis consisted of two vectors $\ket{0} = \smallcolvec{1\\0}$ and $\ket{1} = \smallcolvec{0\\1}$, whereas the qutrit $Z$-basis consists of three vectors:
% \begin{equation}
% 	\ket{0} = \smallcolvec{1\\0\\0}, \hspace{20pt}
% 	\ket{1} = \smallcolvec{0\\1\\0}, \hspace{20pt}
% 	\ket{2} = \smallcolvec{0\\0\\1}. 
% \end{equation}
Let $\omega = e^{i \frac{2\pi}{3}}$ denote the third root of unity
with $\bar\omega = \omega^2$ its complex conjugate.
The qutrit $X$-basis consists of the three vectors: 
\begin{equation}
	\ket{+} = \frac{1}{\sqrt{3}} \left(\ket{0} + \ket{1} + \ket{2}\right)~,~~
	\ket{\omega} = \frac{1}{\sqrt{3}} \left(\ket{0} + \omega\ket{1} + \bar{\omega}\ket{2}\right)~,~~
	\ket{\bar{\omega}} = \frac{1}{\sqrt{3}} \left(\ket{0} + \bar{\omega}\ket{1} + \omega\ket{2}\right)
\end{equation}
In qutrit ZX,
spiders carry \textit{two} phases $\alpha$ and $\beta$,
and have the following concrete representation as linear maps:
\begingroup
	\allowdisplaybreaks
	\setlength{\jot}{10pt}
		\begin{align}
			&\left\llbracket \quad \tikzfig{qutrit_generators/spiders/Z_a_b_labelled} \quad \right\rrbracket = 
			\ket{0}^{\otimes m}\bra{0}^{\otimes n} + 
			e^{i\alpha}\ket{1}^{\otimes m}\bra{1}^{\otimes n} + 
			e^{i\beta}\ket{2}^{\otimes m}\bra{2}^{\otimes n} \\
			&\left\llbracket \quad \tikzfig{qutrit_generators/spiders/X_a_b_labelled} \quad \right\rrbracket = 
			\ket{+}^{\otimes m}\bra{+}^{\otimes n} + 
			e^{i\alpha}\ket{\omega}^{\otimes m}\bra{\omega}^{\otimes n} + 
			e^{i\beta}\ket{\bar{\omega}}^{\otimes m}\bra{\bar{\omega}}^{\otimes n}
			% &\left\llbracket \quad \tikzfig{qutrit_generators/spiders/Z_a_b_labelled} \quad \right\rrbracket = 
			% \ket{0}^{\otimes m}\bra{0}^{\otimes n} + 
			% e^{i\alpha}\ket{1}^{\otimes m}\bra{1}^{\otimes n} + 
			% e^{i\beta}\ket{2}^{\otimes m}\bra{2}^{\otimes n} \\
			% &\left\llbracket \quad \tikzfig{qutrit_generators/spiders/X_a_b_labelled} \quad \right\rrbracket = 
			% \ket{+}^{\otimes m}\bra{+}^{\otimes n} + 
			% e^{i\alpha}\ket{\omega}^{\otimes m}\bra{\omega}^{\otimes n} + 
			% e^{i\beta}\ket{\bar{\omega}}^{\otimes m}\bra{\bar{\omega}}^{\otimes n}
		\end{align}
\endgroup
When $\alpha = \beta = 0$ we will again omit the angles entirely, and just draw a small green or red dot. Throughout our work, whenever we use an integer $n$ as a spider decoration, this is a shorthand for $\frac{2\pi}{3}n$. Since spider phases hold mod $2\pi$, these integer decorations hold mod $3$. Unless otherwise stated, we will use Greek letters to denote general angles, and Roman letters for these integer shorthands.
% This shouldn't ever cause confusion.

Hadamard gates are no longer self-adjoint, so we change our notation: we let a yellow parallelogram decorated with a $1$ (mod $3$) denote a Hadamard gate, while decorating with a $2$ (mod $3$) denotes its adjoint. We will shortly explain this choice. We also use a dashed blue line for the \textit{Hadamard edge} (\textit{$H$-edge}) and a purple dashed line for its adjoint (\textit{$H^\dagger$-edge}):
\begin{equation}
		\tikzfig{hadamard_lemmas/parametrised/1} \ = \ 
		\tikzfig{hadamard_lemmas/dashed/blue} \ = \ 
		\tikzfig{qutrit_rules/hadamard/euler/decomposition} ~~ , 
		\hspace{50pt}
		\tikzfig{hadamard_lemmas/parametrised/2} \ = \ 
		\tikzfig{hadamard_lemmas/dashed/purple} \ = \ 
		\tikzfig{hadamard_lemmas/decompositions/h_dagger_zxz} 
		% \hspace{50pt}
		% \tikzfig{hadamard_lemmas/parametrised/0} \ = \ 
		% \tikzfig{hadamard_lemmas/parametrised/empty}
\end{equation}

% The last equation above just says that a `$0$-Hadamard edge' is in fact the empty diagram, and not an edge at all. 
A very important difference from the qubit case is that in qutrit ZX-calculus there is no `plain' cap or cup:
%. That is, we have the following two results:
\begin{equation}
	\tikzfig{cups_caps/z_cup} \quad \neq \quad \tikzfig{cups_caps/x_cup} \quad , \hspace{50pt}
	\tikzfig{cups_caps/z_cap} \quad \neq \quad \tikzfig{cups_caps/x_cap}
\end{equation}
This has several consequences. Firstly, the maxim that `only topology matters' no longer applies. That is, it is now important to make clear the distinction between a spider's inputs and outputs, unlike in the qubit case where we could freely interchange the two. Diagram components can still be isotoped around the plane but only so long as this input/output distinction is respected. This gives the qutrit calculus a slightly more rigid flavour than its qubit counterpart. That said, this rigidity is loosened by the following two observations.
Firstly, this distinction is irrelevant for $H$- and $H^\dagger$-edges \cite{qutrit_euler}:
	\begin{equation}
		\tikzfig{hadamard_lemmas/io_irrelevant/h/lhs} \ = \ 
		\tikzfig{hadamard_lemmas/io_irrelevant/h/rhs} \ ,
		\hspace{50pt}
		\tikzfig{hadamard_lemmas/io_irrelevant/h_dagger/lhs} \ = \ 
		\tikzfig{hadamard_lemmas/io_irrelevant/h_dagger/rhs}
	\end{equation}
Secondly, the `snake equations' hold for \emph{same-colour} cups and caps.
Snakes with differently coloured cups and caps can still be yanked into a straight wire at the cost of adding two Hadamard boxes, shown below for $h \in \{1, 2\}$:
\begin{equation}
		\tikzfig{qutrit_snake/same_bent} \quad = \quad \tikzfig{qutrit_snake/same_straight} \quad ,
		\hspace{50pt}
		\tikzfig{qutrit_snake/different_bent} \quad = \quad \tikzfig{qutrit_snake/different_straight}
\end{equation}
The above equations hold also if we flip the colours, green $\leftrightarrow$ red.


\subsection{Graph-Like Qutrit ZX Diagrams}

% \numbered{Definition}{A \textit{Hadamard edge} (or \textit{H-edge}) is a Hadamard map connecting two spiders. A \textit{Hadamard adjoint edge} (or \textit{$H^\dagger$-edge) }}


A \emph{graph-like qutrit ZX diagram} is one where
every spider is green,
spiders are only connected Hadamard edges (blue)
or their adjoints (purple),
every pair of spiders is connected by at most one $H$-edge or $H^\dagger$-edge,
every input and output wire is connected to a spider,
and every spider is connected to at most one input or output wire.
A graph-like qutrit ZX diagram is a \textit{graph state} when every spider has zero phase (top and bottom) and is connected to an output. 

% Thanks to Lemma \ref{lem:h_edges_input_output} we can ignore which of a spider's $H$- and $H^\dagger$-legs are inputs and outputs. For our specific needs, the last two items above will not be relevant, since ZX-diagrams arising from knots will be closed, but we include them to keep the definition consistent with the qubit case.

Note the difference compared to the qubit case: we need not worry about self-loops beacuse the qutrit ZX calculus doesn't define a `plain' cap or cup. But this comes at a cost: spiders in the qutrit case fuse more fussily. Specifically, when two spiders of the same colour are connected by at least one plain edge and at least one $H$- or $H^\dagger$-edge, fusion is not possible. The following equation, for $h \in \{1,2\}$, helps us get around this:

\begin{equation}\label{eq:spiders_reluctant_to_fuse}
	\tikzfig{hadamard_lemmas/spiders_reluctant_to_fuse/1} \ \xeq{\qutritRuleHadamard} \
	\tikzfig{hadamard_lemmas/spiders_reluctant_to_fuse/2} \ \xeq{\qutritRuleId} \
	\tikzfig{hadamard_lemmas/spiders_reluctant_to_fuse/3}
\end{equation}

We will shortly show that every qutrit ZX-diagram is equivalent to a graph-like one, making use of the following lemmas:

\begin{lemma}\label{lem:three_H_edges_vanish}
	The following equation holds in the qutrit ZX-calculus:
	\begin{equation}
		\tikzfig{hadamard_lemmas/3_h_edges_vanish/blue} \quad = \quad 
		\tikzfig{hadamard_lemmas/3_h_edges_vanish/disconnected} \quad = \quad 
		\tikzfig{hadamard_lemmas/3_h_edges_vanish/purple}
	\end{equation}
	\begin{proof}
		It is shown in Lemma 2.8 \cite{qutrit_euler} that the qutrit ZX-calculus satisfies the following `Hopf law':
		\begin{equation}\label{eq:qutrit_hopf}
			\tikzfig{hadamard_lemmas/3_h_edges_vanish/hopf/lhs} \quad = \quad 
			\tikzfig{hadamard_lemmas/3_h_edges_vanish/hopf/rhs}
		\end{equation}
		Therefore we can argue as follows, for $h \in \{1, 2\}$:
		\begin{equation}
			\tikzfig{hadamard_lemmas/3_h_edges_vanish/1} \quad \xeq{\qutritRuleHadamard} \quad
			\tikzfig{hadamard_lemmas/3_h_edges_vanish/2} \quad \xeq{\qutritRuleColourChange} \quad
			\tikzfig{hadamard_lemmas/3_h_edges_vanish/3} \quad \xeq{\eqref{eq:qutrit_hopf}} \quad
			\tikzfig{hadamard_lemmas/3_h_edges_vanish/4} \quad \xeq{\eqref{eq:derived_colour_change}} \quad
			\tikzfig{hadamard_lemmas/3_h_edges_vanish/disconnected}
		\end{equation}
	\end{proof}
\end{lemma}

\begin{lemma}\label{lem:H_edges_qutrit} 
	The following two equations hold in the qutrit ZX-calculus:
	\begin{equation}
		\tikzfig{hadamard_lemmas/2_h_edges_flip/2_blue} \quad = \quad 
		\tikzfig{hadamard_lemmas/2_h_edges_flip/1_purple} \quad ,
		\hspace{50pt}
		\tikzfig{hadamard_lemmas/2_h_edges_flip/2_purple} \quad = \quad 
		\tikzfig{hadamard_lemmas/2_h_edges_flip/1_blue}
	\end{equation}
	\begin{proof}
		This is Lemma 3.4 in\ \cite{qutrit_euler}.
	\end{proof}
\end{lemma}

The lemmas above justify our notation for Hadamard gates: we can think of Hadamard edges as $1$-weighted edges and their adjoints as $2$-weighted edges, then work modulo $3$, since every triple of parallel edges disappears. Where the previous lemmas relate single $H$- and $H^\dagger$-boxes across multiple edges, the next relates multiple $H$- and $H^\dagger$- boxes on single edges.

\begin{lemma}\label{lem:H_boxes_qutrit} 
	The following three equations hold in the qutrit ZX calculus, for $h \in \{1, 2\}$:
	\begin{equation}
		\tikzfig{hadamard_lemmas/boxes/4_vanish} \quad ,
		\hspace{50pt}
		\tikzfig{hadamard_lemmas/boxes/3_flip} \quad ,
		\hspace{50pt}
		\tikzfig{hadamard_lemmas/boxes/2_separate}
	\end{equation}
	\begin{proof}
		For the first equation, negate the top two boxes via $\qutritRuleSnake$, then cancel twice via $\qutritRuleHadamard$. Similarly, for the second equation, negate the top two boxes via $\qutritRuleSnake$, then cancel once via $\qutritRuleHadamard$. The third equation is just a simple application of $\qutritRuleId$.
	\end{proof}
\end{lemma}

\begin{corollary}\label{prop:every_diagram_is_graph_like_qutrit}
	Every qutrit ZX diagram is equivalent to one that is graph-like.
	\begin{proof}
		First use the colour change rule to turn all X-spiders into Z-spiders. Then use Lemma \ref{lem:H_boxes_qutrit} to remove excess $H$- and $H^\dagger$-boxes, inserting a spider between any remaining consecutive pair of such boxes, so that all spiders are connected only by plain edges, $H$-edges or $H^\dagger$-edges. Fuse together as many as possible, and apply \eqref{eq:spiders_reluctant_to_fuse} where fusion is not possible, so that no plain edge connects two spiders. Apply Lemmas \ref{lem:three_H_edges_vanish} and \ref{lem:H_edges_qutrit} to all connected pairs of spiders until at most one $H$- or $H^\dagger$-edge remains between them. Finally, to ensure every input and output is connected to a spider and every spider is connected to at most one input or output, we can use $\qutritRuleHadamard$ and $\qutritRuleId$ to add a few spiders, $H$- and $H^\dagger$-boxes as needed: 
		\begin{equation}
			\tikzfig{is_graph_like/plain_input_output_wire} \quad ,
			\hspace{50pt}
			\tikzfig{is_graph_like/input_connected_to_hadamard} \quad ,
			\hspace{50pt}
			\tikzfig{is_graph_like/multiple_inputs_connected_to_one_spider}
		\end{equation}
	\end{proof}
\end{corollary}


A graph state is described fully by its underlying multigraph, or equivalently by an adjacency matrix, where edges take weights in $\mathbb{Z}_3$\ [Lemma 4.2 \cite{harny_completeness}. Nodes correspond to phaseless green spiders, edges of weight $1$ correspond to Hadamard edges, and edges of weight $2$ correspond to $H^\dagger$ edges. As in the qubit case, graph states admit a local complementation operation\ Definition 2.6 \cite{harny_completeness}, though the effect is now slightly more complicated. We'll give the intuition after the formal definition:

\begin{definition}\label{def:local_complementation_qutrit}
	Given $a \in \mathbb{Z}_3$ and a graph state $G$ with adjacency matrix $W = (w_{i,j})$, the \textit{$a$-local complentation} at node $x$ is the new graph state $G *_a x$, whose adjacency matrix $W' = (w'_{i,j})$ given by:
	\begin{equation}
		w'_{i,j} = w_{i,j} + aw_{i,x}w_{j,x}
	\end{equation}
\end{definition}

So only those edges between neighbours of node $x$ are affected, but rather than just having their weight increased by $1$ (modulo $2$) as in the qubit case, the increase in weight also depends on the weights of the edges from $i$ and $j$ to $x$. As always, this is best seen graphically. For two nodes $i$ and $j$ both connected to $x$ by the same colour edge, $a$-local complementation at $x$ increases weight $w_{i,j}$ by $a$. If instead $i$ and $j$ are connected to $x$ by edges of different colour, $a$-local complementation at $x$ decreases $w_{i,j}$ by $a$. We show a fragment of a ZX-diagram below under the effect of this operation:

\begin{equation}
	\tikzfig{a_local_comp/same}
	\hspace{75pt}
	\tikzfig{a_local_comp/different}
\end{equation}

But the fragment above doesn't give the full picture. As in the qubit case, local complementation gives an equality up to introducing some single qubit phase gates on the outputs.

\begin{theorem}\label{thm:local_comp_equality}
	Given $a \in \mathbb{Z}_3$ and a graph state $(G, W)$ containing a node $x$, let $N(x)$ denote the neighbours of $x$ - that is, nodes $i$ with weight $w_{i,x} \in \{1, 2\}$. Then the following equality holds:
	\ctikzfig{graph_state/local_comp}
	\begin{proof}
		This is Theorem 4.4 and Corollary 4.5 in\ \cite{harny_completeness}.
	\end{proof}
\end{theorem}

Composing local complementations gives a local pivot operation.

\begin{definition}\label{def:local_pivot_qutrit}
	Given $a,b,c \in \mathbb{Z}_3$ and a graph state $G$ containing nodes $i$ and $j$, the \textit{$(a,b,c)$-local pivot} along $ij$ is the new graph state $G \wedge_{(a,b,c)} ij \defeq ((G *_a i) *_b j) *_c i$. 
\end{definition}

This again results in an equality, up to introducing some extra gates on outputs. Here we shall only consider an $(a,-a,a)$-local pivot along an edge $ij$ of non-zero weight, for $a \in \{1, 2\}$. We will call this a \textit{proper $a$-local pivot} along $ij$, and denote it $G \wedge_a ij$.

\begin{theorem}\label{thm:local_pivot_equality}
	Given $a \in \mathbb{Z}_3$ and a graph state $(G, W)$ containing connected nodes $i$ and $j$, define the following:
	\begin{itemize}
		\item $N_{=}(i, j) \defeq \left\{x \in N(i) \cap N(j) \mid w_{x,i} = w_{x,j} \right\}$
		\item $N_{\neq}(i, j) \defeq \left\{x \in N(i) \cap N(j) \mid w_{x,i} \neq w_{x,j} \right\}$
	\end{itemize} 
	Then the following equation relates $G$ and its proper $a$-local pivot along $ij$:
	\ctikzfig{graph_state/proper_local_pivot}

	\begin{proof}
		See Appendix \ref{thm:local_pivot_equality_appendix}.
	\end{proof}
\end{theorem}

\subsection{!-Box Notation}

We define here (a very small extension of) the !-notation (pronounced `bang notation'), as introduced in [ToDo] for general string diagrams. A !-box in a ZX-diagram allows its contents to `unfold' out arbitrarily; that is, the contents of the !-box, along with any wires into or out of the box, can be copied $n$ times for any non-negative integer $n$, and placed side-by-side. Consider, for example, the following !-diagram and the infinite set of diagrams it represents:

\begin{equation*}
	\tikzfig{bang/basic/bang} \ = \ \left\{ \quad
		\tikzfig{bang/basic/0} \quad , \quad
		\tikzfig{bang/basic/1} \quad , \quad 
		\tikzfig{bang/basic/2} \quad , \quad 
		\tikzfig{bang/basic/3} \quad , \quad
		... \quad
	\right\}
\end{equation*}

Following the style of [ToDo], we also allow a parameter over which a !-box unfolds. This can parametrise an infinite family of diagrams or restrict to a single instance - for example, letting $[K] = \{1, ..., K\}$, we can write:

\begin{equation*}
	\tikzfig{bang/parametrised/bang} \ = \ 
	\tikzfig{bang/parametrised/3}
\end{equation*}

Finally, we extend this notation as follows: in the corner of the !-box we allow a small further diagram, which denotes that the unfolded diagrams should all be pairwise connected by the diagram in the corner of the box. A common choice of this `corner diagram' is just the plain wire. In our context (qutrit ZX-calculus) this notation will only be well-defined for certain scenarios: in particular, it is well-defined when the corner diagram is a $H$- or $H^{\dagger}$-edge (since then the distinction between a spider's input and output wires disappears) and the main contents of the !-box is equivalent to a single spider (since then there is no ambiguity about which spiders are connected by the corner diagram). For example, we have:

\begin{equation*}
	\tikzfig{bang/connected/bang} \ = \ \left\{ \quad
		\tikzfig{bang/connected/0} \quad , \quad
		\tikzfig{bang/connected/1} \quad , \quad 
		\tikzfig{bang/connected/2} \quad , \quad 
		\tikzfig{bang/connected/3} \quad , \quad
		... \quad
	\right\}
\end{equation*}

\subsection{Qutrit Elimination Theorems}

We classify spiders into three families:

\begin{equation*}
	\mathcal{M} = \left\{\qutritZspider{0}{0}, \qutritZspider{1}{2}, \qutritZspider{2}{1}\right\},
	\hspace{10pt}
	\mathcal{N} = \left\{\qutritZspider{0}{1}, \qutritZspider{1}{0}, \qutritZspider{0}{2}, \qutritZspider{2}{0}\right\},
	\hspace{10pt}
	\mathcal{P} = \left\{\qutritZspider{1}{1}, \qutritZspider{2}{2}\right\}.
\end{equation*}

exactly as in Theorem 3.1 \cite{harny_completeness}. We call a spider in a graph-like ZX-diagram \textit{interior} if it isn't connected to an input or output (so for our use case all spiders are interior). Given any graph-like ZX-diagram, we will show that we can eliminate standalone interior $\mathcal{P}$- and \Nspiders\ by local complementation, and pairs of connected interior \Mspiders\ by local pivoting. 

\begin{theorem}\label{thm:eliminate_P_spiders}
	\eliminatePSpidersStatement
	\begin{proof}
		See Appendix \ref{thm:eliminate_P_spiders_appendix}.
	\end{proof}
\end{theorem}

\begin{theorem}\label{thm:eliminate_N_spiders}
	\eliminateNSpidersStatement
	\begin{proof}
		See Appendix \ref{thm:eliminate_N_spiders_appendix}.
	\end{proof}
\end{theorem}

\begin{theorem}\label{thm:eliminate_M_spiders}
	\eliminateMSpidersStatement
	\begin{proof}
		See Appendix \ref{thm:eliminate_M_spiders_appendix}.
	\end{proof}
\end{theorem}

We can now combine these three elimination theorems into an algorithm for efficiently simplifying a closed graph-like ZX-diagram. First note that after applying any one of the three elimination theorems to such a diagram, the only way we might end up with a non-graph-like diagram is if we introduce parallel $H$- or $H^\dagger$-edges. Fortunately we have shown via Lemmas \ref{lem:three_H_edges_vanish} and \ref{lem:H_edges_qutrit} that these can always be reduced to just one edge, so we do indeed again have a graph-like diagram.

\begin{theorem}\label{thm:simplification_algorithm_works}
	Given any closed graph-like ZX-diagram, the following algorithm will always terminate after a finite number of steps, returning an equivalent graph-like ZX-diagram with no \Nspiders, \Pspiders, or adjacent pairs of \Mspiders. Repeat the steps below until no rule matches. After each step, apply Lemmas \ref{lem:three_H_edges_vanish} and \ref{lem:H_edges_qutrit} as needed until the resulting diagram is graph-like:
	\begin{enumerate}
		\item Eliminate a \Pspider\ via Theorem~\ref{thm:eliminate_P_spiders}.
		\item Eliminate an \Nspider\ via Theorem~\ref{thm:eliminate_N_spiders}.
		\item Eliminate two adjacent \Mspiders\ via Theorem~\ref{thm:eliminate_M_spiders}.
	\end{enumerate}
	\begin{proof}
		At every step the total number of spiders decreases by at least one, so since we start with a finite diagram the algorithm terminates after a finite number of steps. By construction, when it does so we are left with an equivalent graph-like ZX-diagram with no \Nspiders, \Pspiders, or adjacent pairs of \Mspiders.
	\end{proof}
\end{theorem}

\begin{corollary}\label{cor:stabilizer_simplification_algorithm_works}
	In particular, if we start with a stabilizer diagram, we can eliminate all but perhaps one \Mspider, depending on whether the initial number of \Mspiders\ was odd or even. 
	\begin{proof}
		No step introduces any non-stabilizer phases.
	\end{proof}
\end{corollary}

The algorithm above could be extended to graph-like diagrams with inputs or outputs as in Theorem 5.4 \cite{graph_theoretic_simplification}, but since for our purposes we don't need to do so, we have not gone to the trouble.